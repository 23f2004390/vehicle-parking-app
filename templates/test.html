<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Parking Lot Booking</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon/fonts/remixicon.css">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #f0f2f5;
    }

    .container-search {
      padding: 40px;
      background-color: #f9f9f9;
      border-radius: 8px;
      min-height: 100vh;
    }

    .search-container {
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .search-title {
      font-size: 1.8rem;
      margin-bottom: 20px;
      color: #1548ad;
    }

    .search-controls {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .search-dropdown, .search-input {
      padding: 12px 16px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
    }

    .search-input {
      flex: 1;
      min-width: 250px;
    }

    .search-input:focus, .search-dropdown:focus {
      outline: none;
      border-color: #1548ad;
    }

    .example-text {
      background: #e8f2ff;
      padding: 15px;
      border-radius: 6px;
      color: #1548ad;
      font-style: italic;
      border-left: 4px solid #1548ad;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .parking-lot-card {
      background: #fff;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-left: 4px solid #1548ad;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .parking-lot-card:hover {
      transform: scale(1.01);
    }

    .lot-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .lot-title {
      font-size: 1.3rem;
      color: #1548ad;
      font-weight: bold;
    }

    .lot-info p {
      margin: 6px 0;
      color: #444;
    }

    .occupancy-bar {
      width: 100%;
      height: 8px;
      background: #eee;
      border-radius: 4px;
      overflow: hidden;
      margin: 15px 0;
    }

    .occupancy-fill {
      height: 100%;
      background: #28a745;
      transition: width 0.3s ease;
    }

    .spots-preview {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }

    .spot {
      aspect-ratio: 1;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      font-weight: bold;
      cursor: pointer;
    }

    .spot.available {
      background: #28a745;
      color: white;
    }

    .spot.occupied {
      background: #dc3545;
      color: white;
    }

    .popup-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .popup-content {
      background: #fff;
      padding: 30px;
      border-radius: 8px;
      width: 400px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    .popup-content h3 {
      margin-bottom: 20px;
      color: #1548ad;
    }

    .popup-content form div {
      margin-bottom: 15px;
    }

    .popup-content input, .popup-content select {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .popup-content button {
      padding: 10px 16px;
      font-size: 1rem;
      background: #1548ad;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .popup-content button[type="button"] {
      background: #888;
      margin-left: 10px;
    }

    .popup-content button:hover {
      opacity: 0.9;
    }
  </style>
</head>
<body>

<div class="container-search">
  <div class="search-container">
    <h2 class="search-title">Search Parking Lots</h2>
    <div class="search-controls">
      <select class="search-dropdown" id="searchBy">
        <option value="location">Search by Location</option>
        <option value="user_id">Search by User ID</option>
        <option value="lot_name">Search by Lot Name</option>
      </select>
      <input type="text" class="search-input" id="searchInput" placeholder="search . . .">
    </div>
    <div class="example-text">
      Example: Search parking lots by location, user ID, or lot name. e.g. "chennai", "user123", "Parking #12"
    </div>
  </div>

  <div class="results-grid" id="resultsGrid">
    <div class="parking-lot-card"
         data-location="velachery"
         data-name="velachery central"
         data-user_id="user123"
         onclick="openBookingPopup('LOT001')">
      <div class="lot-header">
        <div class="lot-title">Parking #12</div>
      </div>
      <div class="lot-info">
        <p><strong>Location:</strong> Velachery Central</p>
        <p><strong>Occupied:</strong> 3/10 spaces</p>
      </div>
      <div class="occupancy-bar">
        <div class="occupancy-fill" style="width: 30%"></div>
      </div>
      <div class="spots-preview">
        <div class="spot available">A1</div>
        <div class="spot occupied">B1</div>
        <div class="spot available">A2</div>
        <div class="spot available">A3</div>
        <div class="spot available">A4</div>
        <div class="spot available">B2</div>
        <div class="spot available">A5</div>
        <div class="spot occupied">B3</div>
        <div class="spot available">A6</div>
        <div class="spot occupied">B4</div>
      </div>
    </div>
  </div>
</div>

<!-- Booking Popup -->
<div id="bookingPopup" class="popup-overlay">
  <div class="popup-content">
    <h3>Book Parking Spot</h3>
    <form id="bookingForm" method="POST" action="/release_booking">
      <input type="hidden" name="lot_id" id="lotIdInput">
      <div>
        <label for="vehicleNumber">Vehicle Number</label>
        <input type="text" id="vehicleNumber" name="vehicle_number" required>
      </div>
      <div>
        <label for="vehicleType">Vehicle Type</label>
        <select id="vehicleType" name="vehicle_type" required>
          <option value="Car">Car</option>
          <option value="Bike">Bike</option>
          <option value="Auto">Auto</option>
        </select>
      </div>
      <div>
        <label>Start Time</label>
        <input type="text" id="startTime" name="start_time" readonly>
      </div>
      <div>
        <label>End Time</label>
        <input type="text" id="endTime" name="end_time" readonly>
      </div>
      <div style="margin-top: 12px;">
        <button type="submit">Confirm Booking</button>
        <button type="button" onclick="closeBookingPopup()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script>
  // SEARCH LOGIC
  document.getElementById('searchInput').addEventListener('input', function () {
    const searchTerm = this.value.toLowerCase().trim();
    const searchBy = document.getElementById('searchBy').value;
    const cards = document.querySelectorAll('.parking-lot-card');

    cards.forEach(card => {
      let text = '';
      if (searchBy === 'location') text = card.dataset.location || '';
      else if (searchBy === 'lot_name') text = card.dataset.name || '';
      else if (searchBy === 'user_id') text = card.dataset.user_id || '';

      card.style.display = text.toLowerCase().includes(searchTerm) ? 'block' : 'none';
    });
  });

  // BOOKING POPUP
  function openBookingPopup(lotId) {
    document.getElementById('bookingPopup').style.display = 'flex';
    document.getElementById('lotIdInput').value = lotId;
    const now = new Date().toISOString().slice(0, 19).replace("T", " ");
    document.getElementById('startTime').value = now;
    document.getElementById('endTime').value = '';
  }

  function closeBookingPopup() {
    document.getElementById('bookingPopup').style.display = 'none';
  }

  document.getElementById('bookingForm').addEventListener('submit', function () {
    const now = new Date().toISOString().slice(0, 19).replace("T", " ");
    document.getElementById('endTime').value = now;
  });
</script>

</body>
</html>
